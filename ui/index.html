<!doctype html>
<!--
  ArgusCloud UI - Cloud Security Graph Visualization

  This is the modular version that loads CSS and JS from external files.
  See index.original.html for the single-file version.

  PLANNED FEATURES (TODO):

  1. BULK UPLOADER
     - Drag-and-drop interface for bulk importing multiple environments
     - Progress bar with per-file status
     - Batch processing with automatic profile creation per account
     - Support for .tar.gz archives containing multiple environment exports

  2. AWS CREDENTIALS INGESTION
     - Direct AWS credential input from web UI (access key + secret key)
     - Automatic data collection using supplied credentials
     - Real-time progress display during enumeration
     - Support for:
       * Access keys (IAM user credentials)
       * Temporary session tokens (STS)
       * AWS SSO / IAM Identity Center
       * Role assumption chains
     - Secure credential handling (memory-only, never persisted)
     - Rate limiting and error handling for API throttling

  3. MULTI-CLOUD SUPPORT
     - Azure credential ingestion (service principal, managed identity)
     - GCP credential ingestion (service account JSON)
     - Unified graph view across cloud providers
     - Cross-cloud attack path analysis

  4. SCHEDULED SCANS
     - Configure recurring scans for environments
     - Delta comparison between scan results
     - Alert on new high-severity findings
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArgusCloud - Cloud Security Graph Analytics</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
  <!-- External CSS -->
  <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <header>
    <div class="brand">
      <div class="brand-logo">AC</div>
      <div class="brand-text">Argus<span>Cloud</span></div>
    </div>
    <div class="header-status">
      <!-- Profile Selector -->
      <div class="profile-selector">
        <select id="profileSelect" class="profile-dropdown">
          <option value="">-- No Profile --</option>
        </select>
        <button class="btn btn-sm" id="saveProfileBtn" title="Save to Profile">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
        </button>
        <button class="btn btn-sm" id="renameProfileBtn" title="Rename Profile">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
          </svg>
        </button>
        <button class="btn btn-sm" id="deleteProfileBtn" title="Delete Profile" style="background: var(--accent-danger);">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </button>
        <button class="btn btn-sm" id="collectBtn" title="Collect AWS Data" style="background: var(--accent-success); margin-left: 8px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9"></path>
          </svg>
        </button>
        <button class="btn btn-sm" id="bulkUploadBtn" title="Bulk Upload Files" style="background: var(--accent-info);">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
        </button>
      </div>
      <div class="status-badge" id="apiStatus">
        <span class="status-dot"></span>
        <span>API: Checking...</span>
      </div>
      <div class="status-badge" id="neo4jStatus">
        <span class="status-dot"></span>
        <span>Neo4j: Unknown</span>
      </div>
      <button class="theme-toggle" id="themeToggle" title="Toggle theme">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
    </div>
  </header>

  <div class="layout">
    <nav class="sidebar" id="filterSidebar">
      <!-- Resize Handle -->
      <div class="sidebar-resize-handle" id="sidebarResizeHandle" title="Drag to resize"></div>

      <!-- Scrollable content area -->
      <div class="sidebar-content">
        <!-- AWS Attack Queries Section -->
        <div class="sidebar-panel">
          <div class="panel-header">
            <span class="panel-title">AWS Attack Queries</span>
          </div>
          <div class="panel-body">
            <div class="query-category-select">
              <select id="queryCategory" class="form-select">
                <option value="common">Common</option>
                <option value="admin">Admin Access</option>
                <option value="privesc">Privilege Escalation</option>
                <option value="credential">Credential Theft</option>
                <option value="exposure">Public Exposure</option>
                <option value="crossaccount">Cross-Account</option>
                <option value="lateral">Lateral Movement</option>
                <option value="data">Data Exfiltration</option>
              </select>
            </div>
            <div class="query-list" id="queryList">
              <!-- Populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Filters Section -->
        <div class="sidebar-panel">
          <div class="panel-header">
            <span class="panel-title">Filters</span>
            <button class="btn-icon" id="clearAllFiltersBtn" title="Clear All">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="panel-body">
            <!-- Active Filters -->
            <div id="activeFiltersBar" class="active-filters-compact hidden">
              <div class="active-filters-chips" id="activeFiltersChips"></div>
              <span class="clear-link" id="clearAllFiltersLink">Clear all</span>
            </div>

            <!-- Search -->
            <div class="filter-row">
              <input type="search" class="form-input" id="searchInput" placeholder="Search nodes...">
            </div>

            <!-- Resource Type Filter -->
            <div class="filter-section">
          <div class="filter-header" data-section="types">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
              </svg>
              Resource Type
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content" id="typesContent">
            <div class="multi-select" id="typeMultiSelect">
              <div class="multi-select-trigger" id="typeTrigger">
                <div class="multi-select-tags">
                  <span class="multi-select-placeholder">Select types...</span>
                </div>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown hidden" id="typeDropdown">
                <div class="multi-select-search">
                  <input type="text" placeholder="Search types..." id="typeSearchInput">
                </div>
                <div class="multi-select-options" id="typeOptions"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Severity Filter -->
        <div class="filter-section">
          <div class="filter-header" data-section="severity">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
              Severity
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content" id="severityContent">
            <div class="severity-chips">
              <span class="severity-chip critical" data-severity="critical">Critical</span>
              <span class="severity-chip high" data-severity="high">High</span>
              <span class="severity-chip medium" data-severity="medium">Medium</span>
              <span class="severity-chip low" data-severity="low">Low</span>
            </div>
          </div>
        </div>

        <!-- Provider Filter -->
        <div class="filter-section">
          <div class="filter-header" data-section="provider">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
              </svg>
              Provider
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content" id="providerContent">
            <div class="multi-select" id="providerMultiSelect">
              <div class="multi-select-trigger" id="providerTrigger">
                <div class="multi-select-tags">
                  <span class="multi-select-placeholder">All providers</span>
                </div>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown hidden" id="providerDropdown">
                <div class="multi-select-options" id="providerOptions">
                  <div class="multi-select-option" data-value="aws">
                    <input type="checkbox" id="provider-aws">
                    <label for="provider-aws">AWS</label>
                  </div>
                  <div class="multi-select-option" data-value="gcp">
                    <input type="checkbox" id="provider-gcp">
                    <label for="provider-gcp">GCP</label>
                  </div>
                  <div class="multi-select-option" data-value="azure">
                    <input type="checkbox" id="provider-azure">
                    <label for="provider-azure">Azure</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Security Toggles -->
        <div class="filter-section">
          <div class="filter-header" data-section="security">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
              </svg>
              Security Filters
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content" id="securityContent">
            <div class="toggle-row">
              <span class="toggle-label">Has Attack Paths</span>
              <label class="toggle">
                <input type="checkbox" id="hasAttackPathsToggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">Public Exposure</span>
              <label class="toggle">
                <input type="checkbox" id="publicExposureToggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span class="toggle-label">Misconfigured</span>
              <label class="toggle">
                <input type="checkbox" id="misconfiguredToggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Resource Category Filter -->
        <div class="filter-section">
          <div class="filter-header collapsed" data-section="category">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
              </svg>
              Resource Category
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content hidden" id="categoryContent">
            <div class="category-chips">
              <span class="category-chip" data-category="Identity & Access" title="Users, Roles, Groups, Policies">IAM</span>
              <span class="category-chip" data-category="Compute" title="EC2, Lambda, ECS">Compute</span>
              <span class="category-chip" data-category="Storage" title="S3, EBS, EFS">Storage</span>
              <span class="category-chip" data-category="Network" title="VPC, Subnets, Security Groups">Network</span>
              <span class="category-chip" data-category="Security" title="KMS, Secrets Manager">Security</span>
              <span class="category-chip" data-category="Database" title="RDS, DynamoDB">Database</span>
              <span class="category-chip" data-category="Serverless" title="Lambda, API Gateway">Serverless</span>
              <span class="category-chip" data-category="Logging" title="CloudWatch, CloudTrail">Logging</span>
            </div>
          </div>
        </div>

        <!-- Edge Type Filter -->
        <div class="filter-section">
          <div class="filter-header collapsed" data-section="edgeType">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
              Relationship Type
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content hidden" id="edgeTypeContent">
            <div class="multi-select" id="edgeTypeMultiSelect">
              <div class="multi-select-trigger" id="edgeTypeTrigger">
                <div class="multi-select-tags">
                  <span class="multi-select-placeholder">All relationships</span>
                </div>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown hidden" id="edgeTypeDropdown">
                <div class="multi-select-search">
                  <input type="text" placeholder="Search relationships..." id="edgeTypeSearchInput">
                </div>
                <div class="multi-select-options" id="edgeTypeOptions"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Attack Rules Filter -->
        <div class="filter-section">
          <div class="filter-header collapsed" data-section="attackRule">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <path d="M12 8v4"></path>
                <path d="M12 16h.01"></path>
              </svg>
              Attack Rules
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content hidden" id="attackRuleContent">
            <div class="multi-select" id="attackRuleMultiSelect">
              <div class="multi-select-trigger" id="attackRuleTrigger">
                <div class="multi-select-tags">
                  <span class="multi-select-placeholder">All attack rules</span>
                </div>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown hidden" id="attackRuleDropdown">
                <div class="multi-select-search">
                  <input type="text" placeholder="Search rules..." id="attackRuleSearchInput">
                </div>
                <div class="multi-select-options" id="attackRuleOptions"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- MITRE ATT&CK Tactics Filter -->
        <div class="filter-section">
          <div class="filter-header collapsed" data-section="mitre">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
              </svg>
              MITRE ATT&CK
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content hidden" id="mitreContent">
            <div class="mitre-tactics">
              <div class="mitre-tactic" data-tactic="initial-access" title="Techniques used to gain initial foothold">
                <span class="tactic-name">Initial Access</span>
              </div>
              <div class="mitre-tactic" data-tactic="privilege-escalation" title="Techniques to gain higher privileges">
                <span class="tactic-name">Privilege Escalation</span>
              </div>
              <div class="mitre-tactic" data-tactic="credential-access" title="Techniques to steal credentials">
                <span class="tactic-name">Credential Access</span>
              </div>
              <div class="mitre-tactic" data-tactic="lateral-movement" title="Techniques to move through network">
                <span class="tactic-name">Lateral Movement</span>
              </div>
              <div class="mitre-tactic" data-tactic="persistence" title="Techniques to maintain access">
                <span class="tactic-name">Persistence</span>
              </div>
              <div class="mitre-tactic" data-tactic="defense-evasion" title="Techniques to avoid detection">
                <span class="tactic-name">Defense Evasion</span>
              </div>
              <div class="mitre-tactic" data-tactic="exfiltration" title="Techniques to steal data">
                <span class="tactic-name">Exfiltration</span>
              </div>
              <div class="mitre-tactic" data-tactic="impact" title="Techniques to disrupt availability">
                <span class="tactic-name">Impact</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Region Filter (collapsed by default) -->
        <div class="filter-section">
          <div class="filter-header collapsed" data-section="region">
            <span class="filter-title">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
              </svg>
              Region
            </span>
            <svg class="filter-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="filter-content hidden" id="regionContent">
            <div class="multi-select" id="regionMultiSelect">
              <div class="multi-select-trigger" id="regionTrigger">
                <div class="multi-select-tags">
                  <span class="multi-select-placeholder">All regions</span>
                </div>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown hidden" id="regionDropdown">
                <div class="multi-select-search">
                  <input type="text" placeholder="Search regions..." id="regionSearchInput">
                </div>
                <div class="multi-select-options" id="regionOptions"></div>
              </div>
            </div>
          </div>
        </div>

            <!-- Apply Filters Button -->
            <button class="btn btn-primary btn-block" id="filterBtn">Apply Filters</button>
          </div>
        </div>

        <!-- Cypher Query Section -->
        <div class="sidebar-panel">
          <div class="panel-header">
            <span class="panel-title">Cypher Query</span>
          </div>
          <div class="panel-body">
            <textarea class="form-textarea" id="cypherInput" placeholder="MATCH (n) RETURN n LIMIT 25"></textarea>
            <button class="btn btn-secondary btn-block" id="runCypherBtn">Run Query</button>
            <div class="cypher-status" id="cypherStatus"></div>
          </div>
        </div>
      </div>
    </nav>

    <main class="main">
      <div class="tabs">
        <button class="tab active" data-tab="graph">Graph</button>
        <button class="tab" data-tab="env">Environment</button>
        <button class="tab" data-tab="data">Data</button>
        <button class="tab" data-tab="settings">Settings</button>
      </div>

      <div id="msg" class="message error hidden"></div>

      <!-- Graph Tab -->
      <div id="tab-graph">
        <div class="card" id="graphCard">
          <div class="card-header">
            <span class="card-title">Attack Path Graph</span>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary btn-sm" id="resetLayoutBtn">Reset Layout</button>
              <button class="btn btn-secondary btn-sm" id="fullscreenBtn">Fullscreen</button>
            </div>
          </div>
          <div class="card-body">
            <div class="legend">
              <div class="legend-item"><span class="legend-swatch" style="background: var(--node-account)"></span>Account</div>
              <div class="legend-item"><span class="legend-swatch" style="background: var(--node-role)"></span>Role</div>
              <div class="legend-item"><span class="legend-swatch" style="background: var(--node-user)"></span>User</div>
              <div class="legend-item"><span class="legend-swatch" style="background: var(--node-s3)"></span>S3</div>
              <div class="legend-item"><span class="legend-swatch" style="background: var(--node-ec2)"></span>EC2</div>
              <div class="legend-item"><span class="legend-swatch" style="background: var(--severity-high)"></span>Attack Path</div>
            </div>
            <div id="cy"></div>
            <div class="graph-resizer" id="graphResizer"></div>
          </div>
        </div>

        <!-- Graph Analysis Panel (BloodHound-style) -->
        <div class="graph-analysis-panel" id="graphAnalysisPanel">
          <div class="graph-analysis-header" onclick="toggleGraphAnalysisPanel()">
            <span class="graph-analysis-title">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"></path>
              </svg>
              Graph Analysis
            </span>
            <svg class="panel-toggle" id="graphAnalysisToggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <div class="graph-analysis-content hidden" id="graphAnalysisContent">
            <!-- High Value Targets Summary -->
            <div class="high-value-summary" id="highValueSummary">
              <div class="hv-header">
                <span class="hv-title">High-Value Targets</span>
                <span class="hv-count" id="highValueCount">0 detected</span>
              </div>
              <div class="hv-categories" id="highValueCategories"></div>
            </div>

            <!-- Custom Path Finding -->
            <div class="path-finder">
              <div class="section-title">Path Finding</div>
              <div class="path-finder-row">
                <div class="path-select-group">
                  <label>Source</label>
                  <select id="pathSourceSelect" class="form-select">
                    <option value="">Select source...</option>
                    <option value="__INTERNET__">[Internet]</option>
                  </select>
                </div>
                <span class="path-finder-arrow">to</span>
                <div class="path-select-group">
                  <label>Target</label>
                  <select id="pathTargetSelect" class="form-select">
                    <option value="">Select target...</option>
                    <option value="__HIGH_VALUE__">[Any High-Value]</option>
                    <option value="__ADMIN__">[Any Admin]</option>
                    <option value="__DATA__">[Any Data Store]</option>
                    <option value="__SECRETS__">[Any Secret/Key]</option>
                  </select>
                </div>
              </div>
              <div class="path-finder-buttons">
                <button class="btn btn-sm btn-primary" onclick="handleFindPath('shortest')">
                  Find Shortest Path
                </button>
                <button class="btn btn-sm btn-secondary" onclick="handleFindPath('all')">All Paths</button>
                <button class="btn btn-sm btn-ghost" onclick="clearPathHighlight()">Clear</button>
              </div>
            </div>

            <!-- Node Marking -->
            <div class="node-marking-section">
              <div class="section-title">Node Marking</div>
              <div class="marking-stats">
                <span class="marking-stat">Owned: <strong id="ownedNodesCount">0</strong></span>
                <span class="marking-stat">High-Value: <strong id="highValueNodesCount">0</strong></span>
              </div>
              <div class="marking-hint">Ctrl+click = owned | Shift+click = high-value</div>
              <div class="marking-buttons">
                <button class="btn btn-sm btn-secondary" onclick="clearAllMarkers()">Clear Markers</button>
              </div>
            </div>

            <!-- Path Results -->
            <div id="pathResults" class="path-results hidden">
              <div class="section-title">Path Results</div>
              <div id="pathResultsContent"></div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Attack Paths</span>
            <span style="font-size: 12px; color: var(--text-tertiary);" id="attackCount">0 findings</span>
          </div>
          <div class="card-body no-padding">
            <div class="table-wrapper">
              <table id="attacksTable">
                <thead>
                  <tr>
                    <th>Rule</th>
                    <th>Description</th>
                    <th>Severity</th>
                    <th>Source / Target</th>
                    <th style="width: 40px;"></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Selection Details</span>
          </div>
          <div class="card-body">
            <div class="detail-panel" id="detailContent">
              <div class="detail-empty">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M12 16v-4M12 8h.01"></path>
                </svg>
                <p>Click a node or edge in the graph to view details</p>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Cypher Results</span>
          </div>
          <div class="card-body">
            <pre id="cypherOutput">// Query results will appear here</pre>
          </div>
        </div>
      </div>

      <!-- Environment Tab -->
      <div id="tab-env" class="hidden">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Resource Overview</span>
          </div>
          <div class="card-body">
            <div class="stats-grid" id="statsGrid">
              <div class="empty-state">
                <p>Load data to see resource statistics</p>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Environment Objects</span>
            <span style="font-size: 12px; color: var(--text-tertiary);" id="objectCount">0 objects</span>
          </div>
          <div class="card-body no-padding">
            <ul class="env-list" id="envList">
              <li class="empty-state">
                <p>No environment data loaded</p>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Data Tab -->
      <div id="tab-data" class="hidden">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Data Management</span>
          </div>
          <div class="card-body">
            <div class="upload-zone">
              <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <p class="upload-text">Upload ArgusCloud data files to visualize</p>

              <!-- Import method tabs -->
              <div class="import-tabs" style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button class="btn btn-secondary import-tab active" data-tab="multi" style="flex: 1;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                  </svg>
                  Multi-Select
                </button>
                <button class="btn btn-secondary import-tab" data-tab="zip" style="flex: 1;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 8v13H3V8M1 3h22v5H1zM10 12h4"></path>
                  </svg>
                  ZIP File
                </button>
                <button class="btn btn-secondary import-tab" data-tab="folder" style="flex: 1;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                  </svg>
                  Folder
                </button>
              </div>

              <!-- Multi-select panel -->
              <div id="import-multi" class="import-panel">
                <div class="form-group">
                  <label class="form-label">Select JSONL Files (nodes.jsonl + edges.jsonl required)</label>
                  <input type="file" class="form-input" id="multiFiles" accept=".jsonl" multiple>
                  <p class="form-hint" style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">
                    Select all JSONL files from your data folder. Must include nodes.jsonl and edges.jsonl.
                  </p>
                </div>
              </div>

              <!-- ZIP panel -->
              <div id="import-zip" class="import-panel hidden">
                <div class="form-group">
                  <label class="form-label">Upload ZIP Archive</label>
                  <input type="file" class="form-input" id="zipFile" accept=".zip">
                  <p class="form-hint" style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">
                    ZIP file containing nodes.jsonl and edges.jsonl (and optionally other JSONL files).
                  </p>
                </div>
              </div>

              <!-- Folder panel -->
              <div id="import-folder" class="import-panel hidden">
                <div class="form-group">
                  <label class="form-label">Select Data Folder</label>
                  <input type="file" class="form-input" id="folderInput" webkitdirectory directory multiple>
                  <p class="form-hint" style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">
                    Select the folder containing your JSONL data files.
                  </p>
                </div>
              </div>

              <!-- File preview -->
              <div id="filePreview" class="hidden" style="margin: 12px 0; padding: 12px; background: var(--bg-tertiary); border-radius: var(--radius-md); font-size: 12px;">
                <div style="font-weight: 500; margin-bottom: 8px; color: var(--text-secondary);">Selected Files:</div>
                <div id="fileList" style="max-height: 120px; overflow-y: auto; color: var(--text-tertiary);"></div>
              </div>

              <div class="action-buttons" style="justify-content: center; gap: 12px;">
                <button class="btn btn-primary" id="loadBtn">Load Files</button>
                <button class="btn btn-secondary" id="clearBtn" style="background: var(--accent-danger); border-color: var(--accent-danger);">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                  Clear All
                </button>
              </div>
            </div>

            <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-subtle);">
              <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 16px; color: var(--text-secondary);">API Actions</h4>
              <div class="action-buttons">
                <button class="btn btn-secondary" id="fetchApiBtn">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9"></path>
                  </svg>
                  Fetch from API
                </button>
                <button class="btn btn-secondary" id="downloadReportBtn">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Download Report
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div id="tab-settings" class="hidden">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Connection Settings</span>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">API Base URL</label>
              <input type="text" class="form-input" id="apiBase" value="http://127.0.0.1:9847">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Graph Settings</span>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Layout Algorithm</label>
              <select class="form-select" id="layoutSelect">
                <option value="cose">COSE (Force-directed)</option>
                <option value="breadthfirst">Breadthfirst (Hierarchical)</option>
                <option value="concentric">Concentric (Circular)</option>
                <option value="grid">Grid</option>
                <option value="circle">Circle</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Node Label Position</label>
              <select class="form-select" id="labelPos">
                <option value="center">Center</option>
                <option value="bottom">Below</option>
                <option value="top">Above</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Appearance</span>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Theme</label>
              <select class="form-select" id="theme">
                <option value="dark">Dark</option>
                <option value="light">Light</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Save Profile Modal -->
  <div id="saveProfileModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">Save Profile</div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Profile Name</label>
          <input type="text" class="form-input" id="profileNameInput" placeholder="e.g., AWS-Production">
          <p class="form-hint" style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">
            Leave blank to auto-generate from account ID
          </p>
        </div>
        <div id="conflictOptions" class="hidden">
          <p style="color: var(--accent-warning); font-size: 13px; margin-bottom: 8px;">
            Profile already exists. Choose an action:
          </p>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="modeCreate" name="saveMode" value="create" checked>
              <label for="modeCreate">Create New (with different name)</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="modeOverwrite" name="saveMode" value="overwrite">
              <label for="modeOverwrite">Overwrite</label>
              <div class="radio-desc">Replace all existing data in this profile</div>
            </div>
            <div class="radio-option">
              <input type="radio" id="modeMerge" name="saveMode" value="merge">
              <label for="modeMerge">Merge</label>
              <div class="radio-desc">Add to existing data (may create duplicates)</div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelSaveBtn">Cancel</button>
        <button class="btn btn-primary" id="confirmSaveBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirm Modal -->
  <div id="deleteProfileModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">Delete Profile</div>
      <div class="modal-body">
        <p>Are you sure you want to delete profile "<span id="deleteProfileName"></span>"?</p>
        <p style="color: var(--accent-danger); font-size: 13px; margin-top: 8px;">
          This will permanently delete all nodes and edges in this profile.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
        <button class="btn btn-primary" id="confirmDeleteBtn" style="background: var(--accent-danger); border-color: var(--accent-danger);">Delete</button>
      </div>
    </div>
  </div>

  <!-- Rename Profile Modal -->
  <div id="renameProfileModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">Rename Profile</div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Current Name</label>
          <input type="text" class="form-input" id="currentProfileName" disabled style="opacity: 0.6;">
        </div>
        <div class="form-group">
          <label class="form-label">New Name</label>
          <input type="text" class="form-input" id="newProfileName" placeholder="Enter new profile name">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelRenameBtn">Cancel</button>
        <button class="btn btn-primary" id="confirmRenameBtn">Rename</button>
      </div>
    </div>
  </div>

  <!-- AWS Credentials Collection Modal -->
  <div id="collectModal" class="modal-overlay hidden">
    <div class="modal" style="min-width: 500px;">
      <div class="modal-header">
        <span>Collect AWS Data</span>
        <span id="collectJobStatus" style="float: right; font-size: 12px; color: var(--text-tertiary);"></span>
      </div>
      <div class="modal-body">
        <div id="collectForm">
          <div class="form-group">
            <label class="form-label">AWS Access Key ID *</label>
            <input type="text" class="form-input" id="awsAccessKey" placeholder="AKIA..." autocomplete="off">
          </div>
          <div class="form-group">
            <label class="form-label">AWS Secret Access Key *</label>
            <input type="password" class="form-input" id="awsSecretKey" placeholder="Secret key" autocomplete="off">
          </div>
          <div class="form-group">
            <label class="form-label">Session Token (optional, for STS credentials)</label>
            <input type="password" class="form-input" id="awsSessionToken" placeholder="Session token" autocomplete="off">
          </div>
          <div class="form-group">
            <label class="form-label">Region (optional)</label>
            <select class="form-select" id="awsRegion">
              <option value="">Default (us-east-1)</option>
              <option value="us-east-1">us-east-1 (N. Virginia)</option>
              <option value="us-east-2">us-east-2 (Ohio)</option>
              <option value="us-west-1">us-west-1 (N. California)</option>
              <option value="us-west-2">us-west-2 (Oregon)</option>
              <option value="eu-west-1">eu-west-1 (Ireland)</option>
              <option value="eu-west-2">eu-west-2 (London)</option>
              <option value="eu-central-1">eu-central-1 (Frankfurt)</option>
              <option value="ap-northeast-1">ap-northeast-1 (Tokyo)</option>
              <option value="ap-southeast-1">ap-southeast-1 (Singapore)</option>
              <option value="ap-southeast-2">ap-southeast-2 (Sydney)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Profile Name (optional, auto-generated if blank)</label>
            <input type="text" class="form-input" id="collectProfileName" placeholder="e.g., AWS-Production">
          </div>
          <div class="form-group">
            <label class="form-label">Services to Collect</label>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="iam" checked> IAM
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="iam-roles" checked> IAM Roles
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="iam-users" checked> IAM Users
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="iam-policies" checked> IAM Policies
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="s3" checked> S3
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="ec2" checked> EC2
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="lambda"> Lambda
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="kms"> KMS
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="vpc"> VPC
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="rds"> RDS
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="sns"> SNS
              </label>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" class="service-checkbox" value="sqs"> SQS
              </label>
            </div>
            <div style="margin-top: 8px;">
              <button type="button" class="btn btn-sm btn-secondary" onclick="document.querySelectorAll('.service-checkbox').forEach(c => c.checked = true)">Select All</button>
              <button type="button" class="btn btn-sm btn-secondary" onclick="document.querySelectorAll('.service-checkbox').forEach(c => c.checked = false)">Clear All</button>
            </div>
          </div>
        </div>

        <!-- Progress display (shown during collection) -->
        <div id="collectProgress" class="hidden">
          <div style="text-align: center; padding: 20px;">
            <div id="collectSpinner" style="font-size: 24px; margin-bottom: 12px;">
              <svg width="40" height="40" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
                <circle cx="12" cy="12" r="10" stroke="var(--accent-primary)" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"/>
              </svg>
            </div>
            <div id="collectStatusText" style="font-weight: 500; margin-bottom: 8px;">Starting collection...</div>
            <div id="collectCurrentService" style="font-size: 12px; color: var(--text-tertiary);"></div>
            <div style="margin-top: 16px; background: var(--bg-tertiary); border-radius: var(--radius-md); padding: 12px;">
              <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                <span>Progress:</span>
                <span id="collectProgressText">0 / 0 services</span>
              </div>
              <div style="background: var(--bg-primary); border-radius: 4px; height: 8px; overflow: hidden;">
                <div id="collectProgressBar" style="background: var(--accent-primary); height: 100%; width: 0%; transition: width 0.3s;"></div>
              </div>
              <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-tertiary); margin-top: 8px;">
                <span>Nodes: <span id="collectNodeCount">0</span></span>
                <span>Edges: <span id="collectEdgeCount">0</span></span>
              </div>
            </div>
            <div id="collectErrors" class="hidden" style="margin-top: 12px; text-align: left; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-md); padding: 8px; font-size: 11px; color: var(--accent-danger); max-height: 100px; overflow-y: auto;"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelCollectBtn">Cancel</button>
        <button class="btn btn-primary" id="startCollectBtn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9"></path>
          </svg>
          Start Collection
        </button>
      </div>
    </div>
  </div>

  <!-- Bulk Upload Modal -->
  <div id="bulkUploadModal" class="modal-overlay hidden">
    <div class="modal" style="min-width: 600px; max-width: 700px;">
      <div class="modal-header">
        <span>Bulk Upload</span>
        <span id="uploadJobStatus" style="float: right; font-size: 12px; color: var(--text-tertiary);"></span>
      </div>
      <div class="modal-body">
        <!-- Upload Form -->
        <div id="bulkUploadForm">
          <div id="dropZone" class="drop-zone" style="
            border: 2px dashed var(--border-default);
            border-radius: var(--radius-lg);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-tertiary);
          ">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="1.5" style="margin-bottom: 12px;">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <p style="font-weight: 500; margin-bottom: 4px;">Drag & drop files here</p>
            <p style="font-size: 12px; color: var(--text-tertiary);">or click to browse</p>
            <p style="font-size: 11px; color: var(--text-tertiary); margin-top: 12px;">
              Supports: .zip archives or individual .jsonl files<br>
              Each directory becomes a separate profile
            </p>
            <input type="file" id="bulkFileInput" multiple accept=".zip,.jsonl" style="display: none;">
          </div>

          <!-- Selected files preview -->
          <div id="bulkFilePreview" class="hidden" style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <span style="font-weight: 500; font-size: 13px;">Selected Files</span>
              <button type="button" class="btn btn-sm btn-secondary" id="clearBulkFilesBtn">Clear All</button>
            </div>
            <div id="bulkFileList" style="
              max-height: 150px;
              overflow-y: auto;
              background: var(--bg-tertiary);
              border-radius: var(--radius-md);
              padding: 8px;
              font-size: 12px;
            "></div>
            <div style="margin-top: 8px; font-size: 11px; color: var(--text-tertiary);">
              <span id="bulkFileCount">0 files</span> selected
            </div>
          </div>
        </div>

        <!-- Upload Progress -->
        <div id="bulkUploadProgress" class="hidden">
          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 24px; margin-bottom: 12px;">
              <svg width="40" height="40" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
                <circle cx="12" cy="12" r="10" stroke="var(--accent-info)" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"/>
              </svg>
            </div>
            <div id="uploadStatusText" style="font-weight: 500; margin-bottom: 8px;">Uploading...</div>
            <div id="uploadCurrentFile" style="font-size: 12px; color: var(--text-tertiary);"></div>

            <div style="margin-top: 16px; background: var(--bg-tertiary); border-radius: var(--radius-md); padding: 12px;">
              <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                <span>Progress:</span>
                <span id="uploadProgressText">0 / 0 profiles</span>
              </div>
              <div style="background: var(--bg-primary); border-radius: 4px; height: 8px; overflow: hidden;">
                <div id="uploadProgressBar" style="background: var(--accent-info); height: 100%; width: 0%; transition: width 0.3s;"></div>
              </div>
            </div>

            <!-- Profiles created -->
            <div id="uploadProfilesCreated" class="hidden" style="margin-top: 12px; text-align: left;">
              <div style="font-size: 12px; font-weight: 500; margin-bottom: 4px;">Profiles Created:</div>
              <div id="uploadProfilesList" style="
                background: rgba(16, 185, 129, 0.1);
                border: 1px solid rgba(16, 185, 129, 0.3);
                border-radius: var(--radius-md);
                padding: 8px;
                font-size: 11px;
                color: var(--accent-success);
                max-height: 80px;
                overflow-y: auto;
              "></div>
            </div>

            <!-- Errors -->
            <div id="uploadErrors" class="hidden" style="
              margin-top: 12px;
              text-align: left;
              background: rgba(239, 68, 68, 0.1);
              border: 1px solid rgba(239, 68, 68, 0.3);
              border-radius: var(--radius-md);
              padding: 8px;
              font-size: 11px;
              color: var(--accent-danger);
              max-height: 80px;
              overflow-y: auto;
            "></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelBulkUploadBtn">Cancel</button>
        <button class="btn btn-primary" id="startBulkUploadBtn" disabled>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
          Upload & Process
        </button>
      </div>
    </div>
  </div>

  <style>
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .drop-zone.drag-over {
      border-color: var(--accent-info) !important;
      background: rgba(6, 182, 212, 0.1) !important;
    }
    .drop-zone:hover {
      border-color: var(--border-strong);
    }

    /* ============ Expandable Attack Row Styles ============ */
    .attack-row {
      cursor: pointer;
      transition: background 0.15s ease;
    }
    .attack-row:hover {
      background: var(--bg-hover);
    }
    .attack-row.expanded {
      background: var(--bg-tertiary);
      border-bottom: none;
    }
    .expand-cell {
      width: 40px;
      text-align: center;
    }
    .expand-btn {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 4px 8px;
      font-size: 12px;
      transition: transform 0.2s ease;
    }
    .expand-btn:hover {
      color: var(--text-primary);
    }
    .attack-row.expanded .expand-btn {
      transform: rotate(180deg);
    }
    .attack-detail {
      background: var(--bg-tertiary);
    }
    .attack-detail.hidden {
      display: none;
    }
    .attack-detail td {
      padding: 0 !important;
      border-top: none;
    }
    .detail-panel {
      padding: 16px 20px;
      border-top: 1px solid var(--border-subtle);
    }
    .detail-loading {
      color: var(--text-secondary);
      font-size: 13px;
      padding: 20px;
      text-align: center;
    }
    .detail-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
      padding-bottom: 8px;
    }
    .detail-tabs .tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 500;
      transition: all 0.15s ease;
    }
    .detail-tabs .tab:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }
    .detail-tabs .tab.active {
      background: var(--accent-primary);
      color: white;
    }
    .tab-content-container {
      min-height: 150px;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .detail-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .detail-category {
      background: var(--bg-elevated);
      color: var(--text-secondary);
      padding: 4px 10px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .mitre-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(239, 68, 68, 0.15);
      color: var(--accent-danger);
      padding: 3px 8px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.15s ease;
    }
    .mitre-badge:hover {
      background: rgba(239, 68, 68, 0.25);
      color: #f87171;
    }
    .detail-description {
      font-size: 14px;
      color: var(--text-primary);
      line-height: 1.6;
      margin-bottom: 16px;
    }
    .detail-section {
      margin-bottom: 16px;
    }
    .detail-section h4 {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 16px 0 8px;
    }
    .detail-section h4:first-child {
      margin-top: 0;
    }
    .detail-section p {
      font-size: 13px;
      color: var(--text-primary);
      line-height: 1.6;
    }
    .exploit-steps, .remediation-steps {
      margin: 0;
      padding-left: 20px;
      font-size: 13px;
      line-height: 1.8;
      color: var(--text-primary);
    }
    .exploit-steps li, .remediation-steps li {
      margin-bottom: 6px;
    }
    .tool-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .tool-tag {
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      padding: 4px 10px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      color: var(--text-secondary);
      font-family: 'JetBrains Mono', monospace;
    }
    .cli-commands {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      padding: 12px 16px;
      border-radius: var(--radius-md);
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      overflow-x: auto;
      margin-top: 8px;
    }
    .cli-commands code {
      display: block;
      margin-bottom: 8px;
      color: var(--accent-success);
      white-space: pre-wrap;
      word-break: break-all;
    }
    .cli-commands code:last-child {
      margin-bottom: 0;
    }

    /* ============ Graph Analysis Panel Styles ============ */
    .graph-analysis-panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      margin-bottom: 16px;
      overflow: hidden;
    }
    .graph-analysis-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-subtle);
      cursor: pointer;
    }
    .graph-analysis-header:hover {
      background: var(--bg-hover);
    }
    .graph-analysis-title {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .graph-analysis-content {
      padding: 16px;
    }
    .graph-analysis-content.hidden {
      display: none;
    }
    .path-finder {
      margin-bottom: 16px;
    }
    .path-finder-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .path-finder-row select {
      flex: 1;
      padding: 8px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 12px;
    }
    .path-finder-arrow {
      color: var(--text-tertiary);
      font-size: 18px;
    }
    .path-finder-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .security-queries {
      margin-bottom: 16px;
    }
    .security-queries-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-tertiary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .security-query-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .security-query-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .security-query-btn:hover {
      background: var(--bg-hover);
      border-color: var(--border-default);
      color: var(--text-primary);
    }
    .security-query-btn.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: white;
    }

    /* High Value Summary */
    .high-value-summary {
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      padding: 12px;
      margin-bottom: 16px;
      border-left: 3px solid var(--accent-warning);
    }
    .hv-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .hv-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .hv-count {
      font-size: 11px;
      color: var(--accent-warning);
      font-weight: 600;
    }
    .hv-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .hv-category {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      background: var(--bg-primary);
      border-radius: var(--radius-sm);
      font-size: 11px;
      color: var(--text-secondary);
    }
    .hv-category-count {
      background: var(--accent-warning);
      color: var(--bg-primary);
      padding: 1px 5px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 10px;
    }

    /* Section titles */
    .section-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-tertiary);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Attack Path Buttons */
    .attack-path-queries {
      margin-bottom: 16px;
    }
    .attack-path-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    .attack-path-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 8px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .attack-path-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .attack-path-btn.critical {
      border-left: 3px solid var(--accent-danger);
    }
    .attack-path-btn.critical:hover {
      background: rgba(239, 68, 68, 0.1);
      border-color: var(--accent-danger);
    }
    .attack-path-btn.high {
      border-left: 3px solid var(--accent-warning);
    }
    .attack-path-btn.high:hover {
      background: rgba(245, 158, 11, 0.1);
      border-color: var(--accent-warning);
    }
    .attack-path-btn.medium {
      border-left: 3px solid var(--accent-primary);
    }
    .attack-path-btn.medium:hover {
      background: rgba(59, 130, 246, 0.1);
      border-color: var(--accent-primary);
    }
    .apb-icon {
      font-size: 18px;
    }
    .apb-text {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-secondary);
      text-align: center;
    }

    /* Path Select Group */
    .path-select-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .path-select-group label {
      font-size: 10px;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Node Marking Section */
    .node-marking-section {
      margin-bottom: 16px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
    }
    .marking-row {
      display: flex;
      gap: 16px;
      margin-bottom: 8px;
    }
    .marking-stat {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .marking-label {
      font-size: 11px;
      color: var(--text-tertiary);
    }
    .marking-stat strong {
      font-size: 13px;
      color: var(--accent-warning);
    }
    .marking-hint {
      font-size: 10px;
      color: var(--text-tertiary);
      margin-bottom: 10px;
    }
    .marking-buttons {
      display: flex;
      gap: 6px;
    }

    .btn-warning {
      background: var(--accent-warning);
      color: var(--bg-primary);
      border-color: var(--accent-warning);
    }
    .btn-warning:hover {
      background: #d97706;
    }

    .path-finder {
      margin-bottom: 16px;
    }
    .path-finder-row {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      margin-bottom: 12px;
    }
    .path-finder-row select {
      flex: 1;
      padding: 8px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 12px;
    }
    .path-finder-arrow {
      color: var(--text-tertiary);
      font-size: 18px;
      padding-bottom: 8px;
    }
    .path-finder-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .path-results {
      margin-top: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      font-size: 12px;
    }
    .path-results-title {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    .path-results-list {
      color: var(--text-secondary);
    }
    .path-result-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: var(--bg-primary);
      border-radius: var(--radius-sm);
      margin-bottom: 6px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .path-result-item:hover {
      background: var(--bg-hover);
    }
    .path-result-item.active {
      border: 1px solid var(--accent-success);
    }
    .path-length {
      background: var(--accent-primary);
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600;
    }
    .path-endpoints {
      flex: 1;
      font-size: 11px;
      color: var(--text-secondary);
    }

    /* Highlighted path in graph */
    .cy-highlighted {
      border: 2px solid var(--accent-warning) !important;
    }
  </style>
  <!-- External JavaScript -->
  <script src="js/app.js"></script>
</body>
</html>
